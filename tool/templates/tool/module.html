{% extends "tool/base_single_view.html" %}

{% block title %}{{ module.module_code }}{% endblock %}

{% block content %}
    {% if student_attendances %}
    <div class="link-container">
        <a href="#attendance-container" class="btn btn-info" data-toggle="collapse">Attendance</a>
    </div>

    <div id="attendance-container" class="collapse">
        <br>
        <table>
            <tr class="double-header">
                <th class="double-header-left-cell double-header-right-cell" rowspan="2">Student Code</th>
                {# can use first here as we're only referring to lecture dates/titles - same for all students #}
                {% for attendance in student_attendances.0.attendances %}
                <th {% if forloop.last %} class="double-header-right-cell" {% endif %}>
                    <a href="{% url 'tool:lecture' lecture_id=attendance.lecture.id %}">{{ attendance.lecture.date }}</a>
                </th>
                {% endfor %}
                <th class="double-header-right-cell" rowspan="2">% Attended</th>
            </tr>
            <tr class="double-header">
                {% for attendance in student_attendances.0.attendances %}
                <th {% if forloop.last %} class="double-header-right-cell" {% endif %}>
                    <a href="{% url 'tool:lecture' lecture_id=attendance.lecture.id %}">{{ attendance.lecture.session_id }}</a>
                </th>
                {% endfor %}
            </tr>
            {% for student_attendance in student_attendances %}
            {% if forloop.counter|divisibleby:2 %}
            <tr>
            {% else %}
            <tr class="alt">
            {% endif %}
            <td><a href="{% url 'tool:student' student_id=student_attendance.student.id %}">{{ student_attendance.student.user.username }}</a></td>
                {% for attended in student_attendance.attendances %}
                <td>
                    {% if attended.attended %}
                    <i class="fa fa-check fa-lg" aria-hidden="true"></i>
                    {% else %}
                    <i class="fa fa-times fa-lg" aria-hidden="true"></i>
                    {% endif %}
                </td>
                {% endfor %}
                <td>{{ student_attendance.percent_attended|floatformat:2 }}%</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <br>
    <hr>
    <br>
    {{ pie_chart.as_html }}
    {{ line_chart.as_html }}
    {% else %}
    <p>No attendances are available.</p>
    {% endif %}
{% endblock %}
